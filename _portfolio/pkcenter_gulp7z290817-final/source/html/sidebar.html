<div class="sidebar">
    <div class="calend">
        <h3>
            Календарь
        </h3>


        <div id="cal">
            <div class="header">
                <span class="left button" id="prev"> ⟨ </span>
                <span class="left hook"></span>
                <span class="month-year" id="label">Август 2017</span>
                <span class="right hook" id=""></span>
                <span class="right button" id="next"> ⟩ </span>
            </div>
            <table id="days">
                <tbody>
                <tr>
                    <td>пн</td>
                    <td>вт</td>
                    <td>ср</td>
                    <td>чт</td>
                    <td>пт</td>
                    <td>сб</td>
                    <td>вс</td>
                </tr>
                </tbody>
            </table>
            <div id="cal-frame">
                <table class="curr">
                    <tbody>
                    <tr>
                        <td class="nil"></td>
                        <td><a href="#">1</a>
                            <div class="calend__popup">
                                <a href="single__news.html" class="calend__link">засовывание улитки в
                                    хрякушку</a>
                            </div>
                        </td>
                        <td>2</td>
                        <td><a href="#">3</a>
                            <div class="calend__popup">
                                <a href="single__news.html" class="calend__link">йа заголовок</a>
                            </div>
                        </td>
                        <td><a href="#">4</a>
                            <div class="calend__popup">
                                <a href="single__news.html" class="calend__link">Это новость
                                номер 5</a>
                            </div>
                        </td>
                        <td><a href="#">5</a>
                            <div class="calend__popup">
                                <a href="single__news.html" class="calend__link">Уруру</a></div>
                        </td>
                        <td>6</td>
                    </tr>
                    <tr>
                        <td><a href="#">7</a>
                            <div class="calend__popup">
                                <a href="single__news.html" class="calend__link">Что-то ухнуло в
                                лесу.</a>
                            </div>
                        </td>
                        <td>8</td>
                        <td>9</td>
                        <td><a href="#">10</a>
                            <div class="calend__popup">
                                <a href="single__news.html" class="calend__link">швыряние
                                кота</a></div>
                        </td>
                        <td><a href="#">11</a>
                            <div class="calend__popup">
                                <a href="single__news.html" class="calend__link">Крокодил опять
                                ходил</a>
                            </div>
                        </td>
                        <td>12</td>
                        <td>13</td>
                    </tr>
                    <tr>
                        <td>14</td>
                        <td>15</td>
                        <td>16</td>
                        <td>17</td>
                        <td>18</td>
                        <td>19</td>
                        <td class="today">20</td>
                    </tr>
                    <tr>
                        <td>21</td>
                        <td>22</td>
                        <td>23</td>
                        <td>24</td>
                        <td>25</td>
                        <td>26</td>
                        <td>27</td>
                    </tr>
                    <tr>
                        <td>28</td>
                        <td>29</td>
                        <td>30</td>
                        <td>31</td>
                        <td class="nil"></td>
                        <td class="nil"></td>
                        <td class="nil"></td>
                    </tr>
                    </tbody>
                </table>

            </div>
        </div>

        <script src="js/calendar.js"></script>

        <script>
//            data = {
//                "1": [
//                    {"id": 1, "title": "тестовый кот"},
//                    {"id": 6, "title": "зашвыривание тестовой зашвырки"}
//                ],
//                "8": [
//                    {"id": 15, "title": "просто прогулка тест"}
//                ]
//            };

            function redrawCalendar() {
                $('td').map(function (element) {
                    // console.log(element);
                    var day = $(this).html();


                    if (day in data) {
                        var html = '<a href="#">' + day + '</a>';
                        html += '<div class="calend__popup">';
                        data[day].forEach(function (news) {
                            // html += '<p> day: ' + day + '</p>';
                            html += '<a href="\\news\\' + news.id + '" class="calend__link">' + news.title + '</a>';
                        });
                        html += '</div';

                        $(this).html(html);
                    }
                });
            }

            function loadData(year, month) {

                $.get('/days/' + year + '/' + month, function (dat, status) {
                    data = dat;
                    redrawCalendar();
                });

            }

            var cal = CALENDAR();
            cal.init();
            cal.loadData = loadData;
            cal.switchMonth(null, new Date().getMonth(), new Date().getFullYear());

            // ----------
            // - pop-up -
            // ----------

            var selectedTd = null;

            $("td").click(function (event) {
//                console.log('td click');
                if (selectedTd)
                    $(selectedTd).removeClass("action");
                $(this).addClass("action");
                selectedTd = this;

                event.stopPropagation();

            });

            $(window).click(function () {
//                console.log('window clicked');
                if (selectedTd)
                    $(selectedTd).removeClass("action");
            });

        </script>


        <a href="news.html" class="allnews">Все события</a>
    </div>

    <div class="newsfeed">
        <h3>
            Новостная лента
        </h3>

        <ul class="newslist">
            <li class="newslist__item">
                <span class="newsdate">18.04.2017</span>
                <a href="single__news.html" class="newslink">Конкурс им. О. Берггольц: Регламент выступлений</a>
            </li>

            <li class="newslist__item">
                <span class="newsdate">17.04.2017</span>
                <a href="single__news.html" class="newslink">Мастерская «Построй-ка!» опять радует</a>
            </li>

            <li class="newslist__item">
                <span class="newsdate">17.04.2017</span>
                <a href="single__news.html" class="newslink">В ДК «Богатырский 36» состоялось праздничное мероприятие
                    «Пасхальные хлопоты»</a>
            </li>

            <li class="newslist__item">
                <span class="newsdate">16.04.2017</span>
                <a href="single__news.html" class="newslink">Список участников очного тура</a>
            </li>

            <li class="newslist__item">
                <span class="newsdate">16.04.2017</span>
                <a href="single__news.html" class="newslink">Праздник «Пасха» в ДК «Ольгино»</a>
            </li>

            <li class="newslist__item">
                <span class="newsdate">16.04.2017</span>
                <a href="single__news.html" class="newslink">Отмечаем праздник Светлой Пасхи, в ДК «Богатырский 52»</a>
            </li>

            <li class="newslist__item">
                <span class="newsdate">15.04.2017</span>
                <a href="single__news.html" class="newslink">Награждение конкурса «Персонаж»</a>
            </li>

            <li class="newslist__item newslist__item--allnews">
                <a class="newslink" href="news.html">
                    Все новости
                </a>
            </li>
        </ul>


        <div class="stopbanner">
            <a href="news.html"><img src="img/stop-banner.png" alt=""></a>
        </div>
        <!-- end newsfeed -->
    </div>
</div>